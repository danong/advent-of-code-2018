raw_track = r"""                                                                                                             /----------------------------\           
            /-------------------------------------------------------------\                                  |                            |           
            |                               /-------------------\         |                    /-------------+---------------\            |           
            |                               |     /-------------+---------+--------------------+------\      |              /+------------+---------\ 
            |                               |     |         /---+---------+--------------------+------+------+--------------++---\        |         | 
/-----------+-\                             |     |         |   |   /-----+--------------------+------+----\ |              ||   |        |         | 
|           | |                   /---------+-----+---------+---+---+-----+--------------------+------+----+-+------\       ||   |        |         | 
|        /--+-+-------------------+---------+-----+---------+---+---+-----+------\             |      |    | |      |       ||   |        |         | 
|        |  | |                   |         |     |         |   |   |     |      |             |   /--+----+-+---\  |       ||   |        |         | 
|        |/-+-+-------------------+-------\ |     |     /---+---+---+-----+------+-------------+---+--+----+-+---+--+-------++---+--------+---\     | 
|        || | |                   |       | | /---+-----+---+---+---+\    |      |  /----------+---+--+----+-+---+--+------\||   |        |   |     | 
|        || | |                   |       | | |   |     |   |   |   ||/---+------+--+----------+---+\ |    | |   |  |      |||   |        |   |     | 
|    /---++-+-+------->------\    |       | | |   |     |   |   |   |||   |      |  |   /------+---++-+----+-+---+--+-\    |||   |        |   |     | 
|    |   || | |              |    |       | | |   |     |   |   |   |||   |      |  |   |      |   || |    | |   |  | |    |||   |        |   |     | 
\----+---++-+-/              |    |       |/+-+---+-----+---+---+---+++---+------+--+---+------+---++-+----+-+---+--+-+----+++---+--------+\  |     | 
  /--+---++-+--------------\ |/---+-------+++-+---+-----+---+---+---+++--\|      |  |   |      |   || |    | \---+--+-+----+++---+--------/|  |     | 
  |  |   || |              | ||/--+-------+++-+---+-----+---+---+---+++--++------+--+---+------+--\|| |    |     |  | |    |||   |         |  |     | 
  |  |   || |/------->----\| |||  |       ||| |  /+-----+---+---+---+++--++------+--+---+------+--+++-+----+-----+--+-+----+++---+-----\   |  |     | 
  |  |   || ||            || |||  |       ||| |  ||     |   |  /+---+++--++------+--+-\ |      |  ||| |    |     |  | |    |||   |     |   |  |     | 
  |  |   || ||            || |||  |       ||| |  ||     |   |  ||   |||  ||      |  | | |      | /+++-+----+-----+--+-+----+++---+-\   |   |  |     | 
  |  |   || ||            || |||/-+-------+++-+--++-----+---+--++---+++--++------+--+-+-+------+-++++-+----+-----+--+-+----+++---+-+\  |   |  |     | 
  |  |   || ||            || |||| |       ||| |  ||     \---+--++---+++--++------+--+-+-+------+-++++-+----+-----+--+-+----+++---+-++--+---+--/     | 
  |  |   || ||            || |||| |       ||| |  ||         |/-++---+++--++------+--+-+-+------+-++++-+----+-----+--+-+----+++-\ | ||  |   |        | 
  |  |   || ||            ||/++++-+-------+++-+--++---------++-++---+++--++------+--+-+-+------+-++++-+----+\/---+--+-+----+++-+-+\||  |   |        | 
  |  |   || ||            ||||||| |       |\+-+--++---------++-++---+++--++------+--+-+-+------+-++++-+----+++---+--+-+----+++-+-++++--+---/        | 
  |  |   || ||            ||||||| |       | | |  ||    /----++-++---+++--++------+--+-+-+------+-++++-+----+++---+--+-+----+++-+\||||  |            | 
  |  |   || ||            |||||||/+-------+-+-+--++----+----++-++---+++--++------+--+-+-+------+-++++-+----+++---+--+\|    ||| ||||||  |            | 
  |  |   || ||            |||||||||       | | |  ||    |    || ||/--+++--++------+--+-+-+----\ | |||| |    |||   |  |||    ||| ||||||  |            | 
  |  |   || ||       /----+++++++++\      | | |  ||    |  /-++-+++--+++--++------+--+-+-+\   | | |||| |    |||   |  |||    ||| ||||||  |            | 
/-+--+---++-++-------+----++++++++++--\   | | |  ||  /-+--+-++-+++--+++--++------+--+-+-++---+-+-++++-+----+++---+--+++----+++-++++++--+----\       | 
| |  |   \+-++-------+----++++++++++--+---+-+-+--++--+-+--+-++-+++--+++--++------/  | | ||   | |/++++-+---\|||   |  |||    ||| ||||||  |    |       | 
| |  |    | ||       |    ||||||||||  |   | | |  ||  | |  | || |||  v||  ||         | | ||   |/++++++-+---++++---+--+++----+++-++++++--+--\ |       | 
| |  |    | ||       |    ||||||||||  |   | | |  ||  | |  | || |||  |||  ||         | | ||   |||||||| |   ||||   |  |||    ||| ||||||  |  | |       | 
| |  |  /-+-++-------+----++++++++++--+---+-+-+--++--+-+--+-++-+++--+++--++-------\ | | ||   |||||||| |   ||||   |  |||    ||| ||||||  |  | |       | 
| |  |  | | ||       |    ||||||||||  |   | |/+--++--+-+--+-++-+++--+++--++--\    | | | ||   |||||||| |   ||||   |  |||    ||| ||||||  |  | |       | 
| |  |  | | ||       |    ||||^|||||  |   | ||\--++--+-+--+-++-+++--+/|  ||  |    | | | ||   |||||||| |   ||||   |  |||   /+++-++++++--+--+-+\      | 
| |  |  | | ||       |/---++++++++++--+---+\\+---++--+-+--+-++-+/|  | |  ||  |    | | | \+---++++++++-+---++++---+--++/   |||| ||||||  |  | ||      | 
| |  |  | | ||       ||   ||||||||||  |  /++-+---++--+-+--+-++-+-+--+-+--++--+----+\| |  |   |||||||| |   ||||   |  ||    |||| ||||||  |  | |v      | 
| |  |  | | ||      /++---++++++++++--+--+++-+\  ||/-+-+--+-++-+-+--+-+--++--+--\ ||| |  |   |||||||| |   ||||   |  ||    |||| ||||||  |  | ||      | 
|/+--+--+-+-++------+++---++++++++++--+--+++\||  ||| | |  | \+-+-+--+-+--++--+--+-+++-+--+---++++++++-+---++++---+--++----++++-++/|||  |  | ||      | 
\++--+--+-+-++------+++---++++++++++--/ /++++++--+++-+-+--+--+-+-+--+-+--++--+--+-+++-+--+---++++++++-+---++++\  |  ||    |||| || |||  | /+-++------+\
 ||  |  | | ||      |||   ||||||||||    |||||||  ||| | |  |  | | |/-+-+--++--+--+-+++-+--+---++++++++-+---+++++--+--++----++++-++-+++\ | || ||      ||
 ||/-+--+-+-++------+++---++++++++++----+++++++--+++-+-+--+--+-+-++-+-+--++--+--+-+++\|  |   |||||||| |   |||\+--+--++----++++-++-/||| | || ||      ||
 ||| |  | | ||      |||   ||||||||||/---+++++++--+++\| |  |  | \-++-+-+--++--+--+-++++/  |   |||||||| |   ||| |  |  ||    |||| ||  ||| | || ||      ||
 ||| |  | | ||      |||   |||||||||||   |||||||  ||||| |  |  |   || | |  ||  |  | ||||   |   |||||||| |/--+++-+--+--++----++++-++-\||| | || ||      ||
/+++-+--+-+-++------+++---+++++++++++---+++++++--+++++-+--+--+---++-+-+--++--+--+-++++---+\  |||||||| ||  ||| |  |  ||    |||| || |||| | || ||      ||
||||/+--+-+-++------+++---+++++++++++---+++++++-\||||| |  |  |   || | |  ||  |  | ||||   ||/-++++++++-++--+++-+--+-\||    |||| || |||| | || ||      ||
||||||  | | ||      \++---+++++++++++---++++++/ |||||| |  | /+---++-+-+--++--+--+-++++---+++-++++++++-++--+++-+--+-+++----++++-++-++++-+-++-++---\  ||
||||||  | | ||       ||   |||||||||||   ||||||  ||\+++-+--+-++---++-+-+--++--+--+-++++---+++-++++++++-/|  ||| |  | |||    |||| || |||| | || ||   |  ||
||||||  | | || /-----++---+++++++++++---++++++--++-+++-+--+-++---++-+-+--++\ |  | ||||   ||| ||||||||  |  ||| ^  | |||    |||| || |||| | || ||   |  ||
||||||  | | || |     ||/--+++++++++++---++++++--++-+++-+--+-++---++-+-+--+++-+--+-++++---+++-++++++++\ |  ||| |  | |||    |||| || |||| | || ||   |  ||
||||||  | | || |     |||  |||||||||||   ||||||  || ||| |  | ||/--++-+-+--+++-+--+-++++--\||| |\+++++++-+--+++-+--+-+++----++++-++-++++-+-+/ ||   |  ||
||||||  | | || |     |||  |||||||||||   ||||||  || ||| |/-+-+++--++-+-+--+++-+--+-++++--++++\| ||||||| |  ||| |  | |||    |||| || |||| | |  ||   |  ||
||||||  | | || |     |||  |||||||||||   ||||||  || ||| || | ^||  || | \--+++-+--+-++++--++++++-+++++/| |  ||| |  | |||    |||| || |||| | |  ||   |  ||
|||||\--+-+-++-+-----+++--+++/|||||||   ||||||  || ||| || | |||  || |    ||| |  | ||||  |||||| ||||| | |  ||| |  | |||    |||| || |||| | |  ||   |  ||
|||||   | |/++-+-----+++--+++-+++++++---++++++--++-+++-++-+-+++--++-+----+++-+--+-++++-\|||||| ||||| | |  ||| |  | |||    |||| || |||| | |  ||   |  ||
|||||   | |||| |     |||  ||| |||||||   ||||||  || ||| || | |||  || |    ||| |/-+-++++-+++++++-+++++-+-+--+++-+--+-+++---\|||| || |||| | |  ||   |  ||
|||||   |/++++-+-----+++--+++-+++++++---++++++--++-+++-++-+-+++--++-+----+++-++-+-++++-+++++++-+++++-+-+--+++-+\ | |||   ||||| || |||| | |  ||   |  ||
|||||   |||||| |     |||  ||| |||||||   ||||||  || ||| || | |||/-++-+----+++-++-+-++++-+++++++-+++++-+-+--+++-++-+-+++---+++++-++\|||| | |  ||   |  ||
|||||   |||||| |     |||  ||| |||||||   ||||||  || ||| || | ||||/++-+----+++-++-+-++++-+++++++-+++++-+-+--+++-++-+-+++---+++++-+++++++-+-+--++---+\ ||
||||\---++++++-+-----+++--+++-+++++++---++++++--/| ||| || | ||||||| |    ||| || | |||| ||||||| ||||| | |  ||| || | |||   ||||| ||||||| | |  ||   || ||
||||    |||||| |/----+++--+++-+++++++---++++++---+\||| || | ||v|||| |    ||| || | |||| ||||||| ||||| | |  ||| || | |||   ||||| ||||||| | |  ||   || ||
||||    |||||| ||/---+++--+++-+++++++---++++++--\||||| || | ||||||| |    ||| || | ||||/+++++++-+++++-+-+--+++-++-+\|||   ||||| ||||||| | |  ||   || ||
||||    ||||||/+++---+++--+++-+++++++--\||||||  |||||| || | ||||||| |    ||| || | |||||||||||| ||||\-+-+--+++-++-/||||   ||||| ||||||| | |  ||   || ||
||||    ||||||||||   |||  ||| |||||||  |||||||  |||||| || | ||||||\-+----+++-++-+-++++++++++++-++++--+-+--+++-++--++++---+++++-++++++/ | |  ||   || ||
||||   /++++++++++---+++\ ||| |||||||  |||||||  |||||| || | ||||||  |    ||| || | |||||||||||| ||||  | |  ||| ||  ||||  /+++++-++++++--+-+--++---++\||
||||   |||||||||||   ||\+-+++-+++++++--+++++++--++++++-++-+-++++++--+----+++-++-+-++++++++++++-++++--/ |  ||| ||  ||||  |||||| ||||||  | |  ||   |||||
||||   |||||||||||   || | ||| |||||||  |||||||  |||\++-++-+-++++++--+----+++-++-/ |||||||||||| ||||    |  ||| ||  ||||  |||||| ||||||  | |  ||   |||||
||\+---+++++++++++---++-+-+/| |||||||  |||||||  ||| || || | ||||||  |    ||| ||   |||||||||||| ||||    |  ||| ||  ||||  |||||| ||||||  | |  ||   |||||
|| |   ||\++++++++---++-+-+-+-+++++++--+++++++--+++-++-++-+-++++++--+----+++-++---++++++++++++-++++----+--+++-+/  ||||  |||||| ||||||  | |  ||   |||||
|| |   || ||||||||   || | | | |||||||  |||||||  ||| || || | ||||||  |    ||| ||   |||||||||||| ||||    |  ||| |   ||||  |||||| ||||||  | |  ||   |||||
|| |   || ||||||||   || | | | |||||||  |||||||  ||| || || | ||||||  |    ^|| ||   |||||||||||| ||||    |  ||| |   ||||  ||||\+-++++++--+-+--++---+++/|
|| |   || ||||\+++---++-+-+-+-+++++++--/||||||  |\+-++-++-+-++++++--+----+++-++---++++++++++++-++++-->-+--+++-+---++++--++++-+-++++++--/ |  ||   ||| |
|| |   || |||| \++---++-+-+-+-+++++++---++++++--+-+-++-++-+-++++++--+----++/ ||   |||||||||||| ||||    |  ||| |   ||||  |||| | ||||||    |  ||   ||| |
|| |   || ||||  ||   \+-+-+-+-+++++/|   ||||||  | | || || | ||||||  |    ||  ||   ||\+++++++++-++++----+--+++-+---++++--+++/ | ||||||    |  ||   ||| |
|| |   || ||||  ||    | | | | ||||| |   ||||||  | | || || | ||||||  |    ||  ||   || |||||||||/++++->--+--+++-+---++++--+++--+-++++++----+--++\  ||| |
|| |   || ||||  ||    | | | | ||||| |   ||||||  | | || || | ||||||  |    ||  ||   || ||||||||||||||/---+--+++-+---++++--+++--+-++++++----+--+++\ ||| |
||/+---++-++++--++----+-+-+-+-+++++-+---++++++--+-+\|| || | ||||||  |    ||  ||   || |||||||||||||||   |  ||| |   ||||  |||  | ||||||    |  |||| ||| |
||||   || ||||  ||    | | | | |||\+-+---++++++--+-++++-++-+-++++++--+----++--++---++-+++++++++++++++---+--+++-+---+++/  |||  | ||||||    |  |||| ||| |
||||   || ||||  ||    | | | | |||/+-+---++++++--+-++++-++-+-++++++--+----++--++---++-+++++++++++++++---+--+++-+---+++-\ |||  | ||||||    |  |||| ||| |
||||   || ||||  ||    | | | | ||||| | /-++++++--+-++++-++-+-++++++--+----++--++---++-+++++++++++++++---+--+++-+---+++-+-+++\ | ||||||    |  |||| ||| |
||||   || ||||/-++----+-+-+-+-+++++\| | ||||||  | |||| || | ||||||  |    ||  ||   || |\+++++++++++++---+--+++-+---/|| | |||| | ||||||    |  |||| ||| |
||||   || ||||| ||    | | | | ||||||| | ||||||  | |||| || | ||||||  |    ||  |v   || | |||||||||||||   |  |||/+----++-+-++++-+\||||||    |  |||| ||| |
||||   || ||||v ||    | | | | ||||||| | ||||||  | |||| || |/++++++--+----++--++---++-+-+++++++++++++---+--+++++----++-+\|||| ||||||||    |  |||| ||| |
\+++---++-+++++-++----+-+-+-+-+++++++-+-++++++--+-++++-++-++++++++--+----++--++---++-+-+++/|||||||||   |  |||||    || |||||| ||||||||    |  |||| ||| |
 |||   || ||||| ||    \-+-+-+-+++++++-+-+++/||  | |||| || |||||||\--+----++--++---++-+-+++-++/||||||   |  |||||/---++-++++++-++++++++----+\ |||| ||| |
 |||   || ||||| ||      | | | ||||||| | ||| ||  | |||| || |||||||   |    ||  ||   || | ||| || ||\+++---+--/|||||   || |||||| ||||||||    || |||| ||| |
 |||   || ||||| ||      | | | ||||||| | ||| ||  | |||| || \++++++---+----++--++---++-+-++/ \+-++-+++---+---+++++---/| |||||| ||||||||    \+-++++-+++-/
 |||   || v|||| ||     /+-+-+-+++++++-+-+++-++--+-++++-++--++++++---+----++--++---++-+-++---+-++-+++\  |   |||||   /+-++++++-++++++++----\| |||| |||  
 |||   || ||||| ||     || | | ||||||| | ||| ||  | |||| \+--++++++---+----++--++---++-+-++---+-++-++++--+---+++++---++-++++++-+++/||||    || |||| |||  
 |\+---++-+++++-++-----++-+-+-+++++++-+-+++-++--+-+/||  |  |\++++---+----++--++---++-+-++---+-++-++++--+---+++++---++-++++++-+++-++++----++-++++-/||  
 | |   || ||||| ||     || | | ||||||| | ||| ||  | | ||  |  | ||||   |    ||  |\---++-+-++---+-++-++++--+---+++++---++-+++/|| ||| ||||    || ||||  ||  
 | |   || ||||| ||   /-++-+-+-+++++++-+-+++-++--+-+-++--+-\| ||||   |/---++--+----++-+-++---+-++-++++-\|   |||||   || ||| || ||| ||||    || ||||  ||  
 | |   || ||||| ||   | || | | ||||\++-+-+++-++--+-+-++--+-++-++++---++---++--+----++-+-++---+-++-++++-++---+++++---+/ ||| || ||| ||||    || ||||  ||  
/+-+---++-+++++-++---+-++-+-+-++++-++-+-+++-++--+-+-++--+-++-++++\  ||   ||  |    || | ||   | || |||| ||   |||||   |  ||| || ||| ||||    || ||||  ||  
|| |   || ||||| ||   | || | | |||| || | ||| ||  | | ||  |/++-+++++--++---++-\|    || | ||   | || |||| ||   |||||   |  ||| || ||| ||||    || ||||  ||  
|| |   || ||||| ||   | || | | |||| || | ||| ||  | | ||  ||||/+++++--++---++-++----++-+-++---+-++-++++-++-\ |||||   |  ||| || ||| ||||    || ||||  ||  
|| |   || \++++-++---+-++-+-+-++++-++-+-++/ ||  | | ||/-++++++++++--++---++-++----++-+-++--\| || |||| || | |||||   |  ||| || ||| ||||    || ||||  ||  
|| |   ||  |||| ||   | || | | |||| || | ||  |\--+-+-+++-++++++++++--++---++-+/    || | ||  || || |||| || | ||||\---+--+++-++-+++-++++----+/ ||||  ||  
|| |   ||  |||| ||   | || | | |||| || | ||  |   | | ||| ||||||||||  ||   || |     || | ||  || || |||| || | ||||    |  ||| || ||| ||||    |  ||||  ||  
|| |   ||  |\++-++---+-++-+-+-++++-++-+-++--+---+-+-+++-++++++++++--++---+/ |     || | ||  || || |||| || | ||||    |  ||| || ||| ||||    |  ||||  ||  
|| |   ||  | || ||   | || | | |||| || | ||  |   | | ||| |||||\++++--++---+--+-----++-+-++--++-++-++++-++-+-++++----+--+++-++-++/ ||||    |  ||||  ||  
|| |   ||  | || ||   | || | | |||| || | ||  |   | | ||| ||||| ||||  ||   |  |     || | ||  || |\-++++-++-+-++++----+--+++-++-/|  ||||/---+--++++--++\ 
|| |   ||  | || || /-+-++-+-+-++++-++-+-++--+---+-+-+++-+++++-++++--++---+--+-----++-+-++--++-+--++++-++-+-++++-\  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | | || | | |\++-++-+-++--+---+-+-+++-+++++-++++--++---+--+-----++-+-++--++-+--+/|| || | |||| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | | || |/+-+-++-++-+-++--+---+-+-+++-+++++-++++--++---+\ |     || | ||  || |  | || || | |||| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | | || ||| | || || | ||  |   | | ||| ||||| ||||  ||   || |     || | ||  || |  | || || | |||| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | |/++-+++-+-++\|| | ||  |   | | ||| |\+++-++++--++---++-/     || | ||  || |  | || || | ||v| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | ||\+-+++-+-+++++-+-++--+---+-+-+++-+-+++-++++--++---++-------++-+-++--++-+--+-+/ || | |||| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | || || | || | ||| \-+++++-+-++--+---+-+-+++-+-+++-++++--++---/|       || | ||  || |  | |  || | |||| |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | |\-++-+-++-+-+++---+++/| | \+--+---+-+-+++-+-+++-++++--++----+-------++-+-++--++-+--+-+--++-+-+++/ |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | ^  || | || | |||   ||| | |  |  |   | | ||| | ||| ||||  ||    |       || | ||  || |  | |  || | |||  |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | |  || | || | |||   ||| | |  |  |   | | ||| | ||| ||||  \+----+-------++-+-++--++-+--+-+--++-+-/||  |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | |  || | || | ||| /-+++-+-+--+--+---+-+-+++-+-+++\||||   |    |       || | ||  || |  | |  || |  ||  |  |  ||| ||  |  |||||   |  ||||  ||| 
|| |   ||  | |  || | || | |||/+-+++-+-+--+\ |   | | ||| | ||||||||   |    |       || | ||  || |  | |  || |  ||  |  |  ||| \+--+--+++++---+--+/||  ||| 
|| | /-++--+-+--++-+-++-+-+++++\||| | |  || |   | | ||| | ||||||||   |    |       || | ||  || |  | |  || |  ||  |  |  |||  |  |  |||||   |  | ||  ||| 
|| | | ||  | |  || | || | ||||||\++-+-+--++-+---+-+-+++-+-++++++++---+----+-------++-+-++--++-+--+-+--++-+--++--+--+--+++--+--+--+++/|   |  | ||  ||| 
|\-+-+-++--+-+--++-+-++-+-++++++-++-+-+--++-/   | | ||| | ||||||||   |    |       || | ||  || |  | |  || |/-++--+--+--+++--+--+--+++-+---+\ | ||  ||| 
|  | | ||  | |  || | || | |||||| \+-+-+--++-----+-+-+++-+-++++++++---+----+-------++-+-++--++-+--+-+--++-++-++--+--+--/||  |  |  ||| |   || | ||  ||| 
|  | | ||  | |  || | || | ||||||  | | |  ||     | | ||| | ||||||||   |  /-+-------++-+-++--++-+\ \-+--++-++-++--+--+---++--+--+--++/ |   || | ||  ||| 
|  | | ||  | |  || | || | ||||||  | | |  ||     | | ||| | ||||||||   |  | |       || | ||  || ||   |  || || ||  |  |   ||  |  |  ||  |   || | ||  ||| 
|  | | ||  | |  || | || | ||||||  | | |  ||     | | ||| | ||||||||   \--+-+-------++-+-++--++-++---+--/| || ||  |  |   ||  |  |  ||  |   || | ||  ||| 
|  | | ||  | |  || | || | ||||||  | | |  ||     | | ||| | ||||||||      | |       || | ||  || ||   |   | || ||  |  |   ||  |  |  ||  |   || | ||  ||| 
|  |/+-++--+-+--++-+-++-+-++++++--+-+-+--++-----+-+\||| | ||||||||      | |       || | ||  || ||   |   | || ||  |  |   ||  |  |  ||  \---++-+-++--++/ 
|  ||| ||  | \--++-+-++-+-/|||\+--+-+-+--++-----+-+++++-+-+++/||||      | |       || | ||/-++-++---+---+-++-++--+--+---++--+\ |  ||      || | ||  ||  
|  ||| ||  |    || | || |  ||| |  | | |  \+-----+-+++++-+-+++-++++------+-+-------+/ | ||| || ||   |   | || ||  |  |   ||  || |  ||      || | ||  ||  
|  ||| ||  |    || | || |  ||| |  | | |   |     | ||||| | ||| ||||      | |       |  | ||| || ||   |   \-++-++--+--+---++--++-+--+/      || | ||  ||  
|  ||| ||  |    || | || |  ||| |  | | |   |     | ||||| | ||| ||||      | |       |  | ||| || ||   |     || ||  |  |   ||  || |  |       || | ||  ||  
|  ||| ||  |    || | || |  |\+-+--+-+-+---+-----+-+++++-+-+++-++++------+-+-------+--+-+++-++-++---+-----++-/|  |  |   ||  || |  |       || | ||  ||  
|  ||| ||  |    || | || |  | | |  | | |   |     | ||||| | ||| ||||      | |       |  | ||| |v ||   |     ||  |  |  |   ||  || |  |       || | ||  ||  
|  ||| ||  |    || | || |  | | |  | | |   |     | ||||| \-+++-++++------+-+-------+--+-+++-+/ ||   |     ||  |  |  |   ||  || |  |       || | ||  ||  
|  \++-++--+----++-+-++-+--+-+-+--+-+-+---+-----+-+++++---+++-++++------+-+-------+--/ ||| |  \+---+-----++--+--+--+---++--++-+--+-------++-+-/|  ||  
|   || ||  |    || | |\-+--+-+-+--/ | |   |     | |||\+---+++-++++------+-+-------+----+++-+---+---+-----++--+--+--+---++--++-+--+-------++-/  |  ||  
|   |\-++--+----++-+-+--+--+-+-/    | |   |     | ||| |   ||| ||||      | |       |    ||| |   |   |     |\--+--+--+---++--++-+--+-------+/    |  ||  
|   |  ||  |    || | |  |  | |      | |   |     | ||| |   ||| ||||      | |       |    ||| |   |   |     |   |  |  |   ||  || |  |       |     |  ||  
\---+--++--+----++-+-+--+--+-+------+-+---+-----+-+++-+---+++-+++/      | |       |    ||\-+---+---+-----+---+--+--+---++--+/ |  |       |     |  ||  
    |  ||  |    |\-+-+--+--+-+------+-+---+-----/ ||| |   ||| |||       \-+-------+----++--+---/   \-----+---+--+--+---++--+--+--+-------+-----/  ||  
    |  ||  |    |  | |  |  | |      | |   |       ||| |   ||| |\+---------+-------+----++--+-------------+---+--+--+---++--+--+--/       |        ||  
    |  ||  |    |  | \--+--+-+------+-+---+-------+++-+---/|| \-+---------+-------+----+/  |             |   |  |  |   ||  |  |          |        ||  
    |  |\--+----+--+----+--+-+------+-+---+-------+++-+----++---+---------+-------/    |   |             |   \--+--+---++--+--/          |        ||  
    |  \---+----+--+----/  | |      | |   |       ||| |    \+---+---------+------------+---+-------------+------+--+---/|  |             |        ||  
    |      |    |  |       | |      \-+---+-------++/ |     |   |         |            |   |             |      |  |    \--+-------------+--------+/  
    |      |    |  |       | |        |   |       ||  |     \---+---------+------------+---+-------------/      |  |       |             |        |   
    |      \----+--+-------+-+--------+---+-------++--+---------+---------+------------/   |                    |  |       |             |        |   
    |           |  |       | \--------+---/       ||  |         |         |                |                    |  |       |             |        |   
    |           |  |       \----------+-----------++--+---------+---------/                |                    |  \-------+-------------/        |   
    |           |  \------------------+-----------++--+---------+--------------------------+--------------------/          |                      |   
    \-----------+---------------------+-----------+/  |         \--------------------------+-------------------------------+----------------------/   
                |                     \-----------+---+------------------------------------+-------------------------------/                          
                \---------------------------------/   \------------------------------------/                                                          
"""
import itertools

CART_SYMBOLS = {
    '<': (0, -1),
    '>': (0, 1),
    'v': (1, 0),
    '^': (-1, 0)
}

RIGHT = [(0, -1), (-1, 0), (0, 1), (1, 0)]


class Cart:
    def __init__(self, location, direction):
        self.location = location
        self.direction = direction
        self.turns = 0

    def move(self):
        # print(self.direction)
        cur_cell = track[self.location[0]][self.location[1]]
        new_row, new_col = self.location[0] + self.direction[0], self.location[1] + self.direction[1]
        new_cell = track[new_row][new_col]
        # self.location = (new_row, new_col)
        if new_cell == '+':
            turn = self.turns % 3
            if turn == 0:
                self.direction = RIGHT[(RIGHT.index(self.direction) - 1) % 4]
            elif turn == 2:
                self.direction = RIGHT[(RIGHT.index(self.direction) + 1) % 4]
            self.turns += 1
        elif new_cell == '\\':
            if self.direction[0] == 0:
                self.direction = RIGHT[(RIGHT.index(self.direction) + 1) % 4]
            else:
                self.direction = RIGHT[(RIGHT.index(self.direction) - 1) % 4]
        elif new_cell == '/':
            if self.direction[0] == 0:
                self.direction = RIGHT[(RIGHT.index(self.direction) - 1) % 4]
            else:
                self.direction = RIGHT[(RIGHT.index(self.direction) + 1) % 4]
        self.location = (new_row, new_col)


print(raw_track)
track = []
for line in raw_track.splitlines():
    track.append(list(line))
num_rows, num_cols = len(track), len(track[0])
print(num_rows, num_cols)

# remove carts
CARTS = []  # (direction, count)
for ridx, cidx in itertools.product(range(num_rows), range(num_cols)):
    print(ridx, cidx)
    cell_val = track[ridx][cidx]
    if cell_val in CART_SYMBOLS:
        print(cell_val)
        CARTS.append(Cart((ridx, cidx), CART_SYMBOLS[cell_val]))
        if cell_val in ('>', '<'):
            track[ridx][cidx] = '-'
        else:
            track[ridx][cidx] = '|'


# print(len(CARTS))


def get_neighbors(ridx, cidx, max_rows, max_cols):
    for offset in range(-1, 2):
        if 0 <= ridx + offset < max_rows:
            yield ridx + offset, cidx
        if 0 <= cidx + offset < max_cols:
            yield ridx, cidx + offset


def main():
    carts = CARTS
    while len(carts) > 1:
        locations = [c.location for c in carts]
        print(locations)
        carts = sorted(carts, key=lambda x: x.location)
        for idx in range(len(carts)):
            cart = carts[idx]
            if not cart:
                continue
            cart.move()
            matches = [i for i, x in enumerate(carts) if x and x.location == cart.location]
            if len(matches) > 1:
                for j in matches:
                    carts[j] = None
        carts = list(filter(None, carts))
    print(carts[0].location)

if __name__ == '__main__':
    main()
    # pass
